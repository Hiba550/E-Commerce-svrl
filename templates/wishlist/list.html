{% extends "base.html" %}

{% block title %}My Wishlist - Shree Vinayaga{% endblock %}

{% block content %}
<div class="container" style="margin: 2.5rem auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div>
            <h1 style="margin: 0;">My Wishlist</h1>
            <p style="color: #6c757d; margin-top: 0.25rem;">Save products you love and move them to your cart when you're ready.</p>
        </div>
        {% if items %}
        <div style="color: #6c757d;">
            <i class="fas fa-heart" style="color: #dc3545;"></i>
            {{ items|length }} item{{ '' if items|length == 1 else 's' }} saved
        </div>
        {% endif %}
    </div>

    {% if items %}
    <div class="products-grid" style="margin-top: 2rem;">
        {% for item in items %}
        {% set product = item.product %}
        <div class="card wishlist-card">
            <form method="POST" action="{{ url_for('wishlist.remove_from_wishlist', item_id=item.id) }}" class="wishlist-card-remove" title="Remove from wishlist">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit">
                    <i class="fas fa-times"></i>
                </button>
            </form>

              <img src="{% if product and product.image_url %}{% if product.image_url.startswith('/static/') %}{{ product.image_url }}{% else %}{{ url_for('static', filename=product.image_url) }}{% endif %}{% else %}{{ url_for('static', filename='images/product-placeholder.jpg') }}{% endif %}"
                  alt="{{ product.name if product else 'Product' }}"
                  class="card-img" loading="lazy">

            <div class="card-body">
                <h3 class="card-title">{{ product.name if product else 'Product removed' }}</h3>
                {% if product %}
                <p class="card-text" style="margin-bottom: 0.75rem;">{{ product.size }} {{ product.unit }}</p>
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                    <span class="price">₹{{ product.price }}</span>
                    {% if product.mrp and product.mrp > product.price %}
                    <span class="price-original">₹{{ product.mrp }}</span>
                    {% endif %}
                </div>

                {% if product.is_in_stock() %}
                    <span class="badge badge-soft-success"><i class="fas fa-check"></i> In Stock</span>
                {% elif product.is_low_stock() %}
                    <span class="badge badge-soft-warning"><i class="fas fa-exclamation-triangle"></i> Low Stock</span>
                {% else %}
                    <span class="badge badge-soft-danger"><i class="fas fa-times-circle"></i> Out of Stock</span>
                {% endif %}
                {% else %}
                <p style="color: #dc3545; margin-bottom: 0;">This product is no longer available.</p>
                {% endif %}
            </div>

            <div class="card-footer" style="display: grid; gap: 0.75rem;">
                {% if product %}
                <a href="{{ url_for('products.product_detail', slug=product.slug) }}" class="btn btn-outline" style="width: 100%;">
                    <i class="fas fa-eye"></i> View Details
                </a>
                <form method="POST" action="{{ url_for('wishlist.move_to_cart', item_id=item.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-primary" style="width: 100%;" {% if not product.is_in_stock() %}disabled{% endif %}>
                        <i class="fas fa-shopping-cart"></i> Move to Cart
                    </button>
                </form>
                {% else %}
                <button class="btn btn-primary" disabled style="width: 100%; opacity: 0.6;">
                    <i class="fas fa-ban"></i> Unavailable
                </button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card" style="margin-top: 3rem; padding: 3rem; text-align: center; background: white;">
        <i class="fas fa-heart" style="font-size: 3rem; color: #f8d7da; margin-bottom: 1rem;"></i>
        <h2>Your wishlist is feeling lonely</h2>
        <p style="color: #6c757d;">Browse our collection and tap the heart icon to save products for later.</p>
        <a href="{{ url_for('products.list_products') }}" class="btn btn-primary" style="margin-top: 1rem;">
            <i class="fas fa-search"></i> Explore Products
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

